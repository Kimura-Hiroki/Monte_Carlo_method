<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•ï¼ˆå††å‘¨ç‡ã®æ¨å®šï¼‰</title>
  <style>
    :root{
      --bg:#fafcff; --panel:#ffffff; --ink:#1f2a44; --muted:#6b7a99; --line:#e6eef8; --brand:#2f80ed; --ok:#16a34a; --ng:#e11d48;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; color:var(--ink); background:var(--bg)}
    .wrap{max-width:1000px; margin:0 auto; padding:20px}
    header{display:flex; align-items:baseline; gap:12px; flex-wrap:wrap}
    h1{font-size:clamp(20px,4vw,28px); margin:0; color:var(--brand)}
    .sub{color:var(--muted)}

    .grid{display:grid; grid-template-columns: 1fr 320px; gap:16px; margin-top:12px}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }

    .card{background:var(--panel); border:1px solid var(--line); border-radius:14px; box-shadow:0 6px 16px rgba(31,42,68,0.06)}
    .card .hd{padding:12px 14px; border-bottom:1px solid var(--line); font-weight:600; color:var(--muted)}
    .card .bd{padding:14px}

    canvas{width:100%; height:auto; display:block; background:#fff; border-bottom-left-radius:14px; border-bottom-right-radius:14px;}
    .legend{display:flex; gap:12px; align-items:center; color:var(--muted); font-size:13px}
    .dot{width:10px; height:10px; border-radius:50%; display:inline-block}

    .controls{display:grid; grid-template-columns:1fr 1fr; gap:8px}
    button, input, select{font:inherit}
    button{padding:10px 12px; border-radius:10px; border:1px solid var(--line); cursor:pointer; background:#f4f8ff}
    button:hover{filter:brightness(0.98)}
    .primary{background:linear-gradient(#2f80ed,#2267c9); color:#fff; border-color:#1c57ab}
    .danger{background:#fde7eb; border-color:#f6b6c4; color:#b11e3a}
    .full{grid-column: 1 / -1}

    .row{display:flex; align-items:center; gap:10px}
    .mini{font-size:12px; color:var(--muted)}
    .kpi{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px}
    .kpi .item{border:1px solid var(--line); border-radius:10px; padding:10px}
    .kpi .lbl{font-size:12px; color:var(--muted)}
    .kpi .val{font-variant-numeric:tabular-nums; font-size:18px}

    .formula{background:#f7fbff; border:1px dashed #cfe3ff; border-radius:10px; padding:10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;}
    code{background:#eef5ff; padding:2px 4px; border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•ã«ã‚ˆã‚‹å††å‘¨ç‡ã®æ¨å®š</h1>
      <div class="sub">ãƒ©ãƒ³ãƒ€ãƒ ã«ç‚¹ã‚’æ‰“ã¤ã€Œçš„å½“ã¦ã€ã‹ã‚‰ <code>Ï€ â‰ˆ 4Ã—(å††å†…ç‚¹æ•°/å…¨ç‚¹æ•°)</code> ã‚’ä½“æ„Ÿã—ã‚ˆã†</div>
    </header>

    <div class="grid" role="region" aria-label="ãƒ‡ãƒ¢é ˜åŸŸ">
      <!-- å¯è¦–åŒ– -->
      <section class="card">
        <div class="hd">å¯è¦–åŒ–ï¼ˆå˜ä½æ­£æ–¹å½¢ã¨å†…æ¥å††ï¼‰</div>
        <div class="bd" style="padding-bottom:0">
          <div class="legend" aria-hidden="true" style="margin-bottom:8px">
            <span class="dot" style="background:#16a34a"></span> å††ã®å†…å´
            <span class="dot" style="background:#e11d48"></span> å††ã®å¤–å´
          </div>
          <canvas id="plot" width="520" height="520" aria-label="ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­å¯è¦–åŒ–ã‚­ãƒ£ãƒ³ãƒã‚¹"></canvas>
        </div>
      </section>

      <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
      <aside class="card" aria-labelledby="ctl">
        <div class="hd" id="ctl">æ“ä½œã¨çµæœ</div>
        <div class="bd">
          <div class="controls">
            <button id="btnToggle" class="primary">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button id="btnStep">â• 1ã‚¹ãƒ†ãƒƒãƒ—</button>
            <button id="btnReset" class="danger full">ğŸ—‘ ãƒªã‚»ãƒƒãƒˆ</button>
          </div>

          <div class="row" style="margin-top:10px">
            <label class="mini" for="spd">1ã‚¹ãƒ†ãƒƒãƒ—ã®ç‚¹æ•°: <span id="spdVal">200</span></label>
            <input id="spd" type="range" min="10" max="2000" value="200" style="flex:1" />
          </div>

          <div class="kpi" style="margin-top:12px" aria-live="polite">
            <div class="item"><div class="lbl">ç·ç‚¹æ•° n</div><div class="val" id="statN">0</div></div>
            <div class="item"><div class="lbl">å††å†…ç‚¹ in</div><div class="val" id="statIn">0</div></div>
            <div class="item"><div class="lbl">æ¯”ç‡ in/n</div><div class="val" id="statRatio">â€”</div></div>
            <div class="item"><div class="lbl">æ¨å®š Ï€Ì‚</div><div class="val" id="statPi">â€”</div></div>
          </div>

          <div class="formula" style="margin-top:12px" aria-live="polite">
            Ï€ â‰ˆ 4 Ã— (in / n) = 4 Ã— (<span id="fIn">0</span> / <span id="fN">0</span>) = <span id="fPi">â€”</span>
          </div>

          <p class="mini" style="margin-top:10px">
            ã—ãã¿: é¢ç©1ã®æ­£æ–¹å½¢ã«åŠå¾„0.5ã®å††ï¼ˆé¢ç© <code>Ï€Ã—0.5Â²=Ï€/4</code>ï¼‰ã‚’æãã€‚ç‚¹ã‚’ä¸€æ§˜ãƒ©ãƒ³ãƒ€ãƒ ã«æ‰“ã¤ã¨ã€
            <code>å††å†…/å…¨ä½“ â‰ˆ é¢ç©ã®æ¯” = Ï€/4</code> ã¨ãªã‚‹ãŸã‚ã€<code>Ï€ â‰ˆ 4Ã—(å††å†…/å…¨ä½“)</code>ã€‚
          </p>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // ====== åŸºæœ¬æç”» ======
    const canvas = document.getElementById('plot');
    const ctx = canvas.getContext('2d');
    const DPR = Math.max(1, window.devicePixelRatio||1);

    function drawBase(){
      const m = Math.min(canvas.width, canvas.height);
      ctx.clearRect(0,0,canvas.width, canvas.height);
      // å¤–æ 
      ctx.strokeStyle = '#cfd9ea';
      ctx.lineWidth = 2 * DPR;
      ctx.strokeRect(0.5*DPR, 0.5*DPR, m-1*DPR, m-1*DPR);
      // å††ï¼ˆä¸­å¿ƒ(0.5,0.5), åŠå¾„0.5ï¼‰
      ctx.beginPath();
      ctx.arc(m/2, m/2, m/2, 0, Math.PI*2);
      ctx.strokeStyle = '#2f80ed';
      ctx.lineWidth = 3 * DPR;
      ctx.stroke();
    }

    // ====== çŠ¶æ…‹ ======
    let running = false;
    let n = 0, inside = 0;
    let pointsPerStep = 200;
    const colorIn = '#16a34a';
    const colorOut = '#e11d48';

    // ====== è¦ç´ å‚ç…§ ======
    const btnToggle = document.getElementById('btnToggle');
    const btnStep = document.getElementById('btnStep');
    const btnReset = document.getElementById('btnReset');
    const spd = document.getElementById('spd');
    const spdVal = document.getElementById('spdVal');

    const statN = document.getElementById('statN');
    const statIn = document.getElementById('statIn');
    const statRatio = document.getElementById('statRatio');
    const statPi = document.getElementById('statPi');

    const fIn = document.getElementById('fIn');
    const fN = document.getElementById('fN');
    const fPi = document.getElementById('fPi');

    function updateStats(){
      statN.textContent = n.toLocaleString();
      statIn.textContent = inside.toLocaleString();
      if(n>0){
        const ratio = inside/n;
        const pi = 4*ratio;
        statRatio.textContent = ratio.toFixed(6);
        statPi.textContent = pi.toFixed(6);
        fIn.textContent = inside.toLocaleString();
        fN.textContent = n.toLocaleString();
        fPi.textContent = pi.toFixed(6);
      }else{
        statRatio.textContent = 'â€”';
        statPi.textContent = 'â€”';
        fIn.textContent = 0; fN.textContent = 0; fPi.textContent = 'â€”';
      }
    }

    function throwPoints(k){
      const m = Math.min(canvas.width, canvas.height);
      const r = Math.max(1, Math.round(2*DPR));
      for(let i=0;i<k;i++){
        const x = Math.random();
        const y = Math.random();
        const dx = x-0.5, dy = y-0.5;
        const isIn = (dx*dx+dy*dy <= 0.25);
        const px = x*m, py = (1-y)*m; // yä¸Šå‘ã
        ctx.beginPath(); ctx.fillStyle = isIn ? colorIn : colorOut; ctx.arc(px, py, r, 0, Math.PI*2); ctx.fill();
        n++; if(isIn) inside++;
      }
      updateStats();
    }

    function step(){
      throwPoints(pointsPerStep);
    }

    let rafId=null;
    function loop(){
      if(!running) return; step(); rafId = requestAnimationFrame(loop);
    }

    // ====== ã‚¤ãƒ™ãƒ³ãƒˆ ======
    btnToggle.addEventListener('click', ()=>{
      running = !running;
      btnToggle.textContent = running ? 'â¸ ä¸€æ™‚åœæ­¢' : 'â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ';
      btnToggle.classList.toggle('primary', !running);
      if(running) loop(); else if(rafId) cancelAnimationFrame(rafId);
    });

    btnStep.addEventListener('click', ()=>{ running=false; btnToggle.textContent='â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ'; if(rafId) cancelAnimationFrame(rafId); step(); });

    btnReset.addEventListener('click', ()=>{
      running=false; if(rafId) cancelAnimationFrame(rafId);
      n=0; inside=0; updateStats(); drawBase(); btnToggle.textContent='â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ';
    });

    spd.addEventListener('input', (e)=>{ pointsPerStep = parseInt(e.target.value,10)||10; spdVal.textContent = pointsPerStep; });

    // åˆæœŸåŒ–
    drawBase(); updateStats();
  </script>
</body>
</html>
